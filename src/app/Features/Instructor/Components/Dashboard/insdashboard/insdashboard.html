<!-- Main Content -->
<div class="main-content">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="refreshData()">Retry</button>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading && !error">
    <!-- Header -->
    <div class="header d-flex justify-content-between align-items-center">
      <div>
        <h3 class="mb-0">Instructor Dashboard</h3>
        <p class="text-muted mb-0">Welcome back, {{ userData.greetingName }}</p>
      </div>

      <div class="d-flex align-items-center">
        <div class="input-group me-3">
          <input type="text" class="form-control search-box" placeholder="Search...">
          <span class="input-group-text bg-transparent border-0"><i class="fas fa-search"></i></span>
        </div>

        <div class="dropdown me-3">
          <a class="btn btn-light position-relative" href="#" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-bell"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"></span>
          </a>
        </div>

        <div class="dropdown">
          <a class="d-flex align-items-center text-decoration-none dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <!-- <img [src]="userData.avatar" alt="User" class="rounded-circle me-2" width="40" height="40"> -->
            <div class="d-none d-md-block">
              <div>{{ userData.name }}</div>
              <small class="text-muted">{{ userData.role }}</small>
            </div>
          </a>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row">
      <div class="col-xl-3 col-md-6">
        <div class="stats-card courses">
          <div class="d-flex justify-content-between align-items-center">
            <div><h3 class="mb-0">{{ stats.courses }}</h3><p class="text-muted mb-0">Courses</p></div>
            <div class="icon"><i class="fas fa-book"></i></div>
          </div>
          <div class="mt-3">
            <small [class]="getGrowthClass(stats.coursesGrowth)">
              <i [class]="getGrowthIcon(stats.coursesGrowth)"></i>
              {{ formatGrowth(stats.coursesGrowth) }} from last month
            </small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6">
        <div class="stats-card students">
          <div class="d-flex justify-content-between align-items-center">
            <div><h3 class="mb-0">{{ stats.students | number }}</h3><p class="text-muted mb-0">Students</p></div>
            <div class="icon"><i class="fas fa-users"></i></div>
          </div>
          <div class="mt-3">
            <small [class]="getGrowthClass(stats.studentsGrowth)">
              <i [class]="getGrowthIcon(stats.studentsGrowth)"></i>
              {{ formatGrowth(stats.studentsGrowth) }} from last month
            </small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6">
        <div class="stats-card earnings">
          <div class="d-flex justify-content-between align-items-center">
            <div><h3 class="mb-0">${{ stats.earnings | number }}</h3><p class="text-muted mb-0">Earnings</p></div>
            <div class="icon"><i class="fas fa-dollar-sign"></i></div>
          </div>
          <div class="mt-3">
            <small [class]="getGrowthClass(stats.earningsGrowth)">
              <i [class]="getGrowthIcon(stats.earningsGrowth)"></i>
              {{ formatGrowth(stats.earningsGrowth) }} from last month
            </small>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6">
        <div class="stats-card rating">
          <div class="d-flex justify-content-between align-items-center">
            <div><h3 class="mb-0">{{ stats.rating }}</h3><p class="text-muted mb-0">Rating</p></div>
            <div class="icon"><i class="fas fa-star"></i></div>
          </div>
          <div class="mt-3">
            <small [class]="getGrowthClass(stats.ratingGrowth)">
              <i [class]="getGrowthIcon(stats.ratingGrowth)"></i>
              {{ formatGrowth(stats.ratingGrowth) }} from last month
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity & Top Courses -->
    <div class="row mt-4">
      <div class="col-lg-8">
        <div class="recent-activity">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">Recent Activity</h5>
            <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          <div class="activity-list">
            <div class="activity-item" *ngFor="let activity of recentActivities">
              <div class="activity-icon" [class]="activity.type">
                <i [class]="activity.icon"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-0">{{ activity.title }}</h6>
                <p class="text-muted mb-0">{{ activity.description }}</p>
                <small class="text-muted">{{ activity.timestamp }}</small>
              </div>
            </div>
            <div *ngIf="recentActivities.length === 0" class="text-center py-3">
              <p class="text-muted mb-0">No recent activity</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Courses -->
      <div class="col-lg-4">
        <div class="top-courses">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">Top Courses</h5>
            <a routerLink="/instructor/courses" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          <div class="course-list">
            <div class="d-flex align-items-center mb-3" *ngFor="let course of topCourses">
              <img [src]="getImageUrl(course.thumbnailUrl)" class="rounded" width="50" height="50" alt="course" onerror="this.src='https://tse2.mm.bing.net/th/id/OIP.Ct30McAoRmpZ0OH8ii6oeAHaHa?pid=Api&P=0&h=220'">
              <div class="flex-grow-1 ms-3">
                <h6 class="mb-0">{{ course.title }}</h6>
                <small class="text-muted">{{ course.students }} students</small>
              </div>
              <span class="badge bg-primary">{{ course.rating }}</span>
            </div>
            <div *ngIf="topCourses.length === 0" class="text-center py-3">
              <p class="text-muted mb-0">No courses available</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Course Progress -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="recent-activity">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">Course Progress</h5>
            <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          <div class="row">
            <div class="col-md-6 col-lg-4 mb-4" *ngFor="let course of courseProgress">
              <div class="course-card card">
                <div class="position-relative">
<img [src]="getImageUrl(course.thumbnailUrl)" alt="Course Thumbnail" class="img-fluid rounded-3 shadow-sm"
                onerror="this.src='https://tse2.mm.bing.net/th/id/OIP.Ct30McAoRmpZ0OH8ii6oeAHaHa?pid=Api&P=0&h=220'" />
                  <span class="course-badge" *ngIf="course.badge">{{ course.badge }}</span>
                </div>
                <div class="card-body">
                  <h5 class="card-title">{{ course.title }}</h5>
                  <p class="card-text text-muted">{{ course.description }}</p>
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="progress flex-grow-1 me-3">
                      <div class="progress-bar bg-primary" [style.width.%]="course.progress"
                           [attr.aria-valuenow]="course.progress"></div>
                    </div>
                    <small>{{ course.progress }}%</small>
                  </div>
                  <div class="d-flex justify-content-between mt-3">
                    <div><i class="fas fa-users text-muted me-1"></i><small class="text-muted">{{ course.students }} students</small></div>
                    <div><i class="fas fa-star text-warning me-1"></i><small class="text-muted">{{ course.rating }}</small></div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="courseProgress.length === 0" class="col-12 text-center py-5">
              <p class="text-muted">No course progress data available</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
